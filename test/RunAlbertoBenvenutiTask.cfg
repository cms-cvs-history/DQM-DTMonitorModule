process MONITOR = {    

    include "CondCore/DBCommon/data/CondDBSetup.cfi"
    include "Geometry/MuonCommonData/data/muonIdealGeometryXML.cfi"
    include "Geometry/DTGeometry/data/dtGeometry.cfi"
    include "Geometry/MuonNumbering/data/muonNumberingInitialization.cfi"

    source = DaqSource{ string reader = "DTDDUFileReader"
        untracked int32 maxEvents = 10000
        PSet pset = {
             string fileName ="/tmp/giorgia/Wm1S08_default_20mV_r1606.i0"
             untracked bool isRaw = true
             untracked int32 eventsAnalysisRate = 1
        }
    }


    #unpacker
    module dtunpacker = DTUnpackingModule{
       string dataType = "DDU"	
       untracked bool writeSC = true
       untracked bool debugMode = false
       untracked bool readingDDU = true
       untracked bool readDDUIDfromDDU = false	
       untracked bool isRaw = false
       untracked bool globalDAQ = false
       untracked int32 dduID = 730
       untracked bool performDataIntegrityMonitor = false
    }


   #mapping
    es_source roMapping = PoolDBESSource {
       using CondDBSetup
       string connect =  "sqlite_file:database/mapSec8.db"
       untracked string catalog = "file:database/mapCatalog.xml"
       string timetype = "runnumber"
       untracked uint32 authenticationMethod = 0
       VPSet toGet = {{
            string record = "DTReadOutMappingRcd"
            string tag = "channelsMap"
       }}
    }

	
    #noise
    es_source noiseMapping = PoolDBESSource {
       using CondDBSetup
       string connect =  "sqlite_file:database/noise_Sec8.db"
       untracked string catalog = "file:database/catalog.xml"
       string timetype = "runnumber"
       untracked uint32 authenticationMethod = 0
       VPSet toGet = {{
             string record = "DTStatusFlagRcd"
             string tag = "noise"
             }}
    }



    #tTrig
    es_source tTrigMapping = PoolDBESSource {
       using CondDBSetup
       string connect =  "sqlite_file:database/tTrig_Sec8.db"
       untracked string catalog = "file:database/catalog.xml"
       string timetype = "runnumber"
       untracked uint32 authenticationMethod = 0
       VPSet toGet = {{
              string record = "DTTtrigRcd"
              string tag = "tTrig"
          }}
    }



    #tzero
    es_source t0 = PoolDBESSource {
       using CondDBSetup
       VPSet toGet = {
           {string record = "DTT0Rcd"
            string tag = "tzero_13_03_07"
       }   }
       bool loadAll = true
       string connect = "sqlite_file:database/t0.db"
       untracked string catalog = "file:database/catalog.xml"
       string timetype = "runnumber"
    }


    # The module for 1D DT RecHit building
    include "RecoLocalMuon/DTRecHit/data/dt1DRecHits_LinearDrift_CosmicData.cfi"
    replace DTLinearDriftAlgo_CosmicData.recAlgoConfig.hitResolution = 0.05
    replace DTLinearDriftAlgo_CosmicData.recAlgoConfig.tTrigModeConfig.kFactor = -1.00

    ## _Vdrift2D_ ##
    include "RecoLocalMuon/DTSegment/data/dt2DSegments_CombPatternReco2D_LinearDrift_CosmicData.cfi"
    replace DTCombinatorialPatternReco2DAlgo_LinearDrift_CosmicData.Reco2DAlgoConfig.segmCleanerMode = 2
    replace DTCombinatorialPatternReco2DAlgo_LinearDrift_CosmicData.Reco2DAlgoConfig.MaxAllowedHits = 30


    ## _4DAlgo ##
    include "RecoLocalMuon/DTSegment/data/dt4DSegments_CombPatternReco4D_LinearDrift_CosmicData.cfi"
    replace DTCombinatorialPatternReco4DAlgo_LinearDrift_CosmicData.Reco4DAlgoConfig.segmCleanerMode = 2



        # DT Digi DQM
    module TimeBoxProducer = DTAlbertoBenvenutiTask{
       untracked bool debug = true
       untracked string outputFile = "DigiMonitor.root"
       untracked bool readDB = true
       untracked bool localrun = true
       int32 defaultTtrig = 2700
       int32 defaultTmax = 500
       bool performPerWireT0Calibration = true
       untracked int32 tdcRescale = 1
       untracked int32 timeBoxGranularity = 4
       untracked bool checkNoisyChannels = true
    }


    path p = {dtunpacker,TimeBoxProducer}

}

